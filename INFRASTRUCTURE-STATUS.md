# Infrastructure Status - HeroSSID MVP

**Date**: 2025-10-17
**Status**: ✅ Partially Ready (PostgreSQL), ⚠️ Indy Pool Deferred
**Aspire Version**: 9.5.1

---

## Current Infrastructure Status

| Component | Status | Access | Notes |
|-----------|--------|--------|-------|
| **Aspire Dashboard** | ✅ Running | https://localhost:17062 | Monitoring all services |
| **PostgreSQL 17** | ✅ Running | localhost:59203 (dynamic port) | Managed by Aspire |
| **PgAdmin** | ✅ Running | localhost:59223 (dynamic port) | Web UI for PostgreSQL |
| **Indy Pool** | ⚠️ Deferred | N/A | Using mock services for MVP |

---

## What's Working ✅

### 1. .NET Aspire Orchestration
- Dashboard running at https://localhost:17062
- Service discovery operational
- Health monitoring active
- Auto-restart configured

### 2. PostgreSQL Database
- **Container**: `postgres-nuyhxuwn`
- **Image**: postgres:17.6
- **Port**: Dynamic (currently 59203, managed by Aspire)
- **Status**: Healthy and accessible

### 3. PgAdmin Web UI
- **Container**: `pgadmin-tjxyvptc`
- **Image**: dpage/pgadmin4:9.7.0
- **Port**: Dynamic (currently 59223, managed by Aspire)
- **Status**: Running

---

## Deferred: Hyperledger Indy Pool ⚠️

### Why Deferred

The Hyperledger Indy test pool setup has been **intentionally deferred** for the MVP due to complexity:

1. **No Pre-built Image**:
   - `bcgovimages/von-network` doesn't exist in Docker Hub
   - Von Network requires building from source
   - Official Hyperledger `indy_pool` image also requires local build

2. **Build Complexity**:
   ```bash
   # Von Network approach (requires cloning repo)
   git clone https://github.com/bcgov/von-network
   cd von-network
   ./manage build
   ./manage start

   # OR Official Indy SDK approach
   git clone https://github.com/hyperledger/indy-sdk
   cd indy-sdk
   docker build -f ci/indy-pool.dockerfile -t indy_pool .
   docker run -itd -p 9701-9708:9701-9708 indy_pool
   ```

3. **MVP Decision**:
   - Focus on database and service layer first
   - Use mock ledger services for initial implementation
   - Add real Indy integration in Phase 2 after service layer is stable

### Current Approach

**Phase 1 (Current)**: Use mock implementations
- `ILedgerDIDService` → Mock/stub implementation
- `ILedgerSchemaService` → Mock/stub implementation
- `ILedgerCredentialService` → Mock/stub implementation

**Phase 2 (After Service Layer Complete)**: Integrate real Indy pool
- Build `indy_pool` Docker image locally
- Uncomment Indy pool configuration in AppHost.cs
- Replace mock implementations with real Indy SDK calls

---

## How to Access Services

### 1. Aspire Dashboard (Recommended)

```bash
# Already running! Open in browser:
https://localhost:17062/login?t=48905a9fd6143b86012fb3b9c6af5378
```

**Features**:
- View all service status
- Check logs in real-time
- Monitor resource usage
- See connection strings

### 2. PostgreSQL (via Connection String)

Aspire auto-generates connection strings. Get them from the dashboard under "Resources" → "postgres".

Example connection string pattern:
```
Host=localhost;Port=<dynamic-port>;Database=herossid;Username=postgres;Password=<auto-generated>
```

### 3. PgAdmin Web UI

Access via: `http://localhost:<dynamic-port>` (check Aspire dashboard for current port)

Default credentials managed by Aspire.

---

## Database Migration Status

**Status**: ⏳ Pending

The EF Core migration has been created but not yet applied:
- Migration file: `src/Libraries/HeroSSID.Data/Migrations/*_InitialCreate.cs`
- Entities ready: `DID`, `CredentialSchema`, `CredentialDefinition`, `VerifiableCredential`

### Apply Migrations

```bash
cd src/Libraries/HeroSSID.Data
dotnet ef database update --startup-project ../../Services/HeroSSID.AppHost
```

This will create all tables in the PostgreSQL database.

---

## Next Steps

### Immediate (Today)

1. ✅ **Infrastructure Running** - Aspire + PostgreSQL operational
2. ⏳ **Apply Database Migrations** - Create tables
3. ⏳ **Begin Phase 2 Implementation** - DID operations with mock ledger

### Short-term (This Week)

4. ⏳ **Implement Service Layer** - With mock Indy services
5. ⏳ **Write Integration Tests** - Using Testcontainers for PostgreSQL
6. ⏳ **CLI Commands** - Basic CRUD operations

### Medium-term (Next Week)

7. ⏳ **Build Indy Pool Locally** - For real ledger integration
8. ⏳ **Replace Mock Services** - With real Indy SDK implementations
9. ⏳ **End-to-End Testing** - Full credential lifecycle

---

## Advantages of Current Approach

### 1. Faster MVP Development
- No waiting for Indy pool builds
- Can develop and test service layer immediately
- Database and business logic independent of ledger

### 2. Better Test Coverage
- Mock services easier to test
- Can simulate error conditions
- Faster test execution

### 3. Clear Separation of Concerns
- Database layer ✅ (working)
- Service layer ⏳ (ready to implement)
- Ledger integration ⚠️ (deferred, well-abstracted)

### 4. Easy Migration Path
All ledger operations behind interfaces:
```csharp
ILedgerDIDService
ILedgerSchemaService
ILedgerCredentialDefinitionService
ILedgerCredentialService
```

Swapping mock → real implementation requires **zero changes** to business logic.

---

## Indy Pool Setup Guide (For Future)

When ready to integrate real Indy pool, follow these steps:

### Option A: Official Indy Pool (Recommended)

```bash
# 1. Clone Indy SDK
git clone https://github.com/hyperledger/indy-sdk
cd indy-sdk

# 2. Build indy-pool image
docker build -f ci/indy-pool.dockerfile -t indy_pool .

# 3. Run pool (ports 9701-9708)
docker run -itd -p 9701-9708:9701-9708 indy_pool

# 4. Uncomment Indy pool in AppHost.cs
# Edit: src/Services/HeroSSID.AppHost/AppHost.cs
# Uncomment lines 14-22

# 5. Restart Aspire
cd src/Services/HeroSSID.AppHost
dotnet run
```

### Option B: Von Network (Alternative)

```bash
# 1. Clone Von Network
git clone https://github.com/bcgov/von-network
cd von-network

# 2. Build and start
./manage build
./manage start

# 3. Access web UI
http://localhost:9000

# 4. Get genesis file
curl http://localhost:9000/genesis > genesis/pool_transactions_genesis
```

---

## Troubleshooting

### Aspire Dashboard Not Accessible

```bash
# Check if process is running
# Look for output: "Now listening on: https://localhost:17062"

# If not running, restart:
cd src/Services/HeroSSID.AppHost
dotnet run
```

### PostgreSQL Connection Issues

1. Check Aspire dashboard for current port (it's dynamic)
2. Verify container is running: `docker ps | grep postgres`
3. Check logs in Aspire dashboard

### Want to Stop Everything

```bash
# Press Ctrl+C in the terminal where Aspire is running
# OR kill the process

# Containers will stop automatically
docker ps  # Should show no HeroSSID containers
```

---

## Performance Notes

### Startup Time
- **Aspire Dashboard**: ~5 seconds
- **PostgreSQL**: ~10 seconds (includes healthcheck)
- **PgAdmin**: ~10 seconds
- **Total**: ~15-20 seconds to fully operational

### Resource Usage
- **Aspire**: ~100-200 MB RAM
- **PostgreSQL**: ~50-100 MB RAM
- **PgAdmin**: ~100-150 MB RAM
- **Total**: ~300-450 MB RAM

Very lightweight for development!

---

## Conclusion

Infrastructure is **ready for Phase 2 implementation**:

✅ **Working**:
- Aspire orchestration
- PostgreSQL database
- PgAdmin web UI
- Service discovery

⚠️ **Deferred** (By Design):
- Hyperledger Indy pool (using mocks initially)

This approach allows rapid development of the service layer while maintaining a clear path to full Indy integration.

**Ready to proceed with Phase 2: DID Operations (with mock ledger services).**

---

**Last Updated**: 2025-10-17 22:31 UTC
**Next Review**: After database migrations applied
